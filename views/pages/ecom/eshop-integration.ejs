<head>
  <%- include('../../partials/head') %>
</head>
 
<body data-theme="light" class="font-nunito">
  <div id="wrapper" class="theme-cyan">
 
    <!-- HEADER -->
    <%- include('../../partials/header') %>
 
    <!-- SIDEBAR -->
    <%- include('../../partials/left-sidebar') %>
    <%- include('../../partials/right-iconbar') %>
 
    <!-- MAIN CONTENT -->
    <div id="main-content">
      <div class="container-fluid">
        <!-- Page Header -->
        <div class="block-header">
          <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-12">
              <h2>Dashboard</h2>
              <ul class="breadcrumb">
                <li class="breadcrumb-item">
                  <a href="/"><i class="fa fa-dashboard"></i></a>
                </li>
                <li class="breadcrumb-item active">Dashboard</li>
              </ul>
            </div>
 
            <!-- Uncomment this block if you need page actions like Download/Add -->
            <!--
            <div class="col-lg-6 col-md-6 col-sm-12">
              <div class="d-flex flex-row-reverse">
                <div class="page_action">
                  <button type="button" class="btn btn-primary">
                    <i class="fa fa-download"></i> Download report
                  </button>
                  <button type="button" class="btn btn-secondary">
                    <i class="fa fa-plus"></i> Add new
                  </button>
                </div>
              </div>
            </div>
            -->
          </div>
        </div>
 
        <!-- MAIN BODY CONTENT -->
        <div class="max-w-md w-full border border-gray-300 rounded-lg p-6">
          <div class="flex items-center space-x-2 mb-4 text-gray-700 font-semibold text-sm">
            <i class="fas fa-project-diagram text-gray-500 text-lg"></i>
            <span>Select Channel</span>
          </div>
          <div class="mb-6">
            <div class="relative text-gray-400 focus-within:text-gray-600">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3">
                <i class="fas fa-search text-sm"></i>
              </span>
              <input
                class="block w-full bg-white border border-gray-300 rounded-md py-2 pl-10 pr-3 text-sm placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500"
                placeholder="Search Channel"
                type="text"
              />
            </div>
          </div>
          <p class="text-xs font-semibold text-gray-700 mb-3">Popular Channels</p>
          <div class="grid grid-cols-2 gap-4">
            <button
              type="button"
              data-bs-toggle="modal"
              data-bs-target="#shopifyIntegrationModal"
              class="flex items-center space-x-2 border border-gray-300 rounded-md px-4 py-3 text-gray-700 text-sm hover:shadow-sm"
            >
              <img
                alt="Shopify logo green shopping bag with white S letter"
                class="w-6 h-6"
                height="24"
                src="https://storage.googleapis.com/a1aa/image/7654eb21-bb30-4a12-bd79-a526802c045d.jpg"
                width="24"
              />
              <span>Shopify</span>
            </button>
            <button
              class="flex items-center space-x-2 border border-gray-300 rounded-md px-4 py-3 text-gray-700 text-sm hover:shadow-sm"
              type="button"
            >
              <img
                alt="Woocommerce logo purple speech bubble with Woo text"
                class="w-12 h-6"
                height="24"
                src="https://storage.googleapis.com/a1aa/image/5ef3de3c-7dd3-48df-ef4d-dc903226b1ba.jpg"
                width="48"
              />
              <span>Woocommerce</span>
            </button>
            <button
              class="flex items-center space-x-2 border border-gray-300 rounded-md px-4 py-3 text-gray-700 text-sm hover:shadow-sm"
              type="button"
            >
              <img
                alt="Amazon logo black letter A with orange arrow"
                class="w-6 h-6"
                height="24"
                src="https://storage.googleapis.com/a1aa/image/8e02b41c-bb40-425b-72b0-5b09a5cb29c2.jpg"
                width="24"
              />
              <span>Amazon</span>
            </button>
            <button
              class="flex items-center space-x-2 border border-gray-300 rounded-md px-4 py-3 text-gray-700 text-sm hover:shadow-sm"
              type="button"
            >
              <img
                alt="Custom channel icon dark blue document with plus sign"
                class="w-6 h-6"
                height="24"
                src="https://storage.googleapis.com/a1aa/image/6c505352-5be1-403c-be65-b766b9dbde31.jpg"
                width="24"
              />
              <span>Custom</span>
            </button>
          </div>
        </div>
      
        <!-- Shopify Integration Modal -->
        <div
          class="modal fade"
          id="shopifyIntegrationModal"
          tabindex="-1"
          aria-labelledby="shopifyModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-3 shadow">
              <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="shopifyModalLabel">
                  Connect Your Shopify Store
                </h5>
                <button
                  type="button"
                  class="btn-close btn-close-white"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
      
              <form id="shopifyIntegrationForm">
                <div class="modal-body">
                  <div class="mb-3">
                    <label for="shopUrl" class="form-label fw-semibold"
                      >Shopify Store URL</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="shopUrl"
                      placeholder="example.myshopify.com"
                      required
                    />
                  </div>
                  <div class="mb-3">
                    <label for="accessToken" class="form-label fw-semibold"
                      >Access Token</label
                    >
                    <input
                      type="password"
                      class="form-control"
                      id="accessToken"
                      placeholder="Enter access token"
                      required
                    />
                  </div>
                  <div class="form-text">
                    Need help?
                    <a
                      href="https://shopify.dev/docs/api/access-tokens"
                      target="_blank"
                      >How to get Shopify access token</a
                    >
                  </div>
                </div>
      
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-outline-secondary"
                    data-bs-dismiss="modal"
                  >
                    Cancel
                  </button>
                  <button type="button" class="btn btn-primary" id="connectShopifyBtn">Connect Store</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      
        <!-- Bootstrap Bundle JS (with Popper) -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
         <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <!-- Form Handling Script -->
    // ... existing code ...
<script>
  document.getElementById("connectShopifyBtn").addEventListener("click", async function () {
    const shopUrl = document.getElementById("shopUrl").value.trim();
    const accessToken = document.getElementById("accessToken").value.trim();

    if (!shopUrl || !accessToken) {
      Swal.fire({
        icon: 'error',
        title: 'Oops...',
        text: 'Please fill in both fields.',
      });
      return;
    }

    try {
      const response = await axios.post("/api/shopify/connect", {
        shopUrl,
        accessToken,
      });

      if (response.data.success) {
        const modal = bootstrap.Modal.getInstance(document.getElementById("shopifyIntegrationModal"));
        modal.hide();
        Swal.fire(
          'Connected!',
          'Your Shopify store has been connected successfully.',
          'success'
        ).then(() => {
          window.location.href = '/ecom/shop-integration'; // Redirect after alert is closed
        });
      } else {
        Swal.fire({
          icon: 'error',
          title: 'Connection Failed',
          text: response.data.message || "Unknown error",
        });
      }
    } catch (error) {
      console.error("Axios Error:", error);
      const errorMessage = error.response?.data?.message || 'Error connecting to Shopify.';
      Swal.fire({
        icon: 'error',
        title: 'Error',
        text: errorMessage,
      });
    }
  });
</script>
// ... existing code ...

 
      </div>
   <!-- External JS -->
   <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
   <script src="/js/main.js"></script>
      <!-- FOOTER -->
      <%- include('../../partials/footer') %>
    </div>
 
  </div>
 
